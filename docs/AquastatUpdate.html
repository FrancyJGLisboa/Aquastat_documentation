<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 3 The faoswsAquastaUpdate module | Migration of AQUASTAT Statistical Processes into the SWS</title>
  <meta name="description" content="This online book describes the migration the statistical processes associated with the AQUASTAT - FAO Global’s Water Information System into the Corporate Statistical Working System (SWS)">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 3 The faoswsAquastaUpdate module | Migration of AQUASTAT Statistical Processes into the SWS" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This online book describes the migration the statistical processes associated with the AQUASTAT - FAO Global’s Water Information System into the Corporate Statistical Working System (SWS)" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 The faoswsAquastaUpdate module | Migration of AQUASTAT Statistical Processes into the SWS" />
  
  <meta name="twitter:description" content="This online book describes the migration the statistical processes associated with the AQUASTAT - FAO Global’s Water Information System into the Corporate Statistical Working System (SWS)" />
  

<meta name="author" content="Francy Lisboa (Agronomist/Statistician, ESSD - Methodological Innovation Team)">


<meta name="date" content="2019-03-21">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="External.html">
<link rel="next" href="AquastatValidation.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<script src="libs/viz-0.3/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.0/grViz.js"></script>



<link rel="stylesheet" href="ess.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#introduction"><strong>Introduction</strong></a><ul>
<li><a href="index.html#data-collection"><strong>Data Collection</strong></a></li>
<li><a href="index.html#questionnaire"><strong>Questionnaire</strong></a></li>
<li><a href="index.html#the-current-aquastat-information-management"><strong>The current AQUASTAT information management</strong></a></li>
<li><a href="index.html#code-lists"><strong>Code lists</strong></a></li>
<li><a href="index.html#data-tables"><strong>Data tables</strong></a></li>
<li><a href="index.html#datasets"><strong>Datasets</strong></a></li>
<li><a href="index.html#international-classification-systems"><strong>International Classification Systems</strong></a></li>
<li><a href="index.html#the-sws-aquastat_reference-data-table"><strong>The SWS aquastat_reference data table</strong></a><ul>
<li><a href="index.html#current-aquastat-variables"><strong>Current AQUASTAT Variables</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="AquastatLegacy.html"><a href="AquastatLegacy.html"><i class="fa fa-check"></i><b>1</b> <strong>The faoswsAquastatLegacy module</strong></a><ul>
<li class="chapter" data-level="1.1" data-path="AquastatLegacy.html"><a href="AquastatLegacy.html#aim"><i class="fa fa-check"></i><b>1.1</b> <strong>Aim</strong></a><ul>
<li class="chapter" data-level="1.1.1" data-path="AquastatLegacy.html"><a href="AquastatLegacy.html#identify-ltas"><i class="fa fa-check"></i><b>1.1.1</b> <strong>Identify LTAs</strong></a></li>
<li class="chapter" data-level="1.1.2" data-path="AquastatLegacy.html"><a href="AquastatLegacy.html#calculations-before"><i class="fa fa-check"></i><b>1.1.2</b> <strong>Calculations before</strong></a></li>
<li class="chapter" data-level="1.1.3" data-path="AquastatLegacy.html"><a href="AquastatLegacy.html#corrections"><i class="fa fa-check"></i><b>1.1.3</b> <strong>Corrections</strong></a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="AquastatLegacy.html"><a href="AquastatLegacy.html#workflow"><i class="fa fa-check"></i><b>1.2</b> <strong>Workflow</strong></a></li>
<li class="chapter" data-level="1.3" data-path="AquastatLegacy.html"><a href="AquastatLegacy.html#running-the-module"><i class="fa fa-check"></i><b>1.3</b> <strong>Running the module</strong></a></li>
<li class="chapter" data-level="1.4" data-path="AquastatLegacy.html"><a href="AquastatLegacy.html#did-the-module.."><i class="fa fa-check"></i><b>1.4</b> <strong>Did the module..</strong></a><ul>
<li class="chapter" data-level="1.4.1" data-path="AquastatLegacy.html"><a href="AquastatLegacy.html#correct-values-of-long-term-average-variables"><i class="fa fa-check"></i><b>1.4.1</b> correct values of Long-Term Average variables ?</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="AquastatLegacy.html"><a href="AquastatLegacy.html#output-feeds"><i class="fa fa-check"></i><b>1.5</b> <strong>Output feeds…</strong></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="External.html"><a href="External.html"><i class="fa fa-check"></i><b>2</b> <strong>The faoswsAquastatExternal module</strong></a><ul>
<li class="chapter" data-level="2.1" data-path="External.html"><a href="External.html#aims"><i class="fa fa-check"></i><b>2.1</b> <strong>Aims</strong></a><ul>
<li class="chapter" data-level="2.1.1" data-path="External.html"><a href="External.html#identifies-aquastat-external-data-sources"><i class="fa fa-check"></i><b>2.1.1</b> <strong>Identifies AQUASTAT external data sources</strong></a></li>
<li class="chapter" data-level="2.1.2" data-path="External.html"><a href="External.html#reshapes-the-data-sources"><i class="fa fa-check"></i><b>2.1.2</b> <strong>Reshapes the data sources</strong></a></li>
<li class="chapter" data-level="2.1.3" data-path="External.html"><a href="External.html#maps-out-aquastat-to-external-sources"><i class="fa fa-check"></i><b>2.1.3</b> <strong>Maps out AQUASTAT to external sources</strong></a></li>
<li class="chapter" data-level="2.1.4" data-path="External.html"><a href="External.html#saves-the-output-back-into-sws"><i class="fa fa-check"></i><b>2.1.4</b> <strong>Saves the output back into SWS</strong></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="External.html"><a href="External.html#workflow-1"><i class="fa fa-check"></i><b>2.2</b> <strong>Workflow</strong></a></li>
<li class="chapter" data-level="2.3" data-path="External.html"><a href="External.html#running-the-module-1"><i class="fa fa-check"></i><b>2.3</b> <strong>Running the module</strong></a></li>
<li class="chapter" data-level="2.4" data-path="External.html"><a href="External.html#did-the-module..-1"><i class="fa fa-check"></i><b>2.4</b> <strong>Did the module..</strong></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="AquastatUpdate.html"><a href="AquastatUpdate.html"><i class="fa fa-check"></i><b>3</b> <strong>The faoswsAquastaUpdate module</strong></a><ul>
<li class="chapter" data-level="3.1" data-path="AquastatUpdate.html"><a href="AquastatUpdate.html#aims-1"><i class="fa fa-check"></i><b>3.1</b> <strong>Aims</strong></a><ul>
<li class="chapter" data-level="3.1.1" data-path="AquastatUpdate.html"><a href="AquastatUpdate.html#harmonize-dimensions"><i class="fa fa-check"></i><b>3.1.1</b> <strong>Harmonize dimensions</strong></a></li>
<li class="chapter" data-level="3.1.2" data-path="AquastatUpdate.html"><a href="AquastatUpdate.html#replacesupdates-the-legacy-data"><i class="fa fa-check"></i><b>3.1.2</b> <strong>Replaces/updates the legacy data</strong></a></li>
<li class="chapter" data-level="3.1.3" data-path="AquastatUpdate.html"><a href="AquastatUpdate.html#does-calculations"><i class="fa fa-check"></i><b>3.1.3</b> <strong>Does Calculations</strong></a></li>
<li class="chapter" data-level="3.1.4" data-path="AquastatUpdate.html"><a href="AquastatUpdate.html#applies-primary-variable-approach"><i class="fa fa-check"></i><b>3.1.4</b> <strong>Applies Primary Variable Approach</strong></a></li>
<li class="chapter" data-level="3.1.5" data-path="AquastatUpdate.html"><a href="AquastatUpdate.html#applies-imputations"><i class="fa fa-check"></i><b>3.1.5</b> <strong>Applies imputations</strong></a></li>
<li class="chapter" data-level="3.1.6" data-path="AquastatUpdate.html"><a href="AquastatUpdate.html#recalculates-indicators"><i class="fa fa-check"></i><b>3.1.6</b> <strong>Recalculates indicators</strong></a></li>
<li class="chapter" data-level="3.1.7" data-path="AquastatUpdate.html"><a href="AquastatUpdate.html#maps-out-flags-observation"><i class="fa fa-check"></i><b>3.1.7</b> <strong>Maps out flags (Observation)</strong></a></li>
<li class="chapter" data-level="3.1.8" data-path="AquastatUpdate.html"><a href="AquastatUpdate.html#maps-out-flags-method"><i class="fa fa-check"></i><b>3.1.8</b> <strong>Maps out flags (Method)</strong></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="AquastatUpdate.html"><a href="AquastatUpdate.html#workflow-2"><i class="fa fa-check"></i><b>3.2</b> <strong>Workflow</strong></a></li>
<li class="chapter" data-level="3.3" data-path="AquastatUpdate.html"><a href="AquastatUpdate.html#running-the-module-2"><i class="fa fa-check"></i><b>3.3</b> <strong>Running the module</strong></a></li>
<li class="chapter" data-level="3.4" data-path="AquastatUpdate.html"><a href="AquastatUpdate.html#did-the-module"><i class="fa fa-check"></i><b>3.4</b> <strong>Did the module…</strong></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="AquastatValidation.html"><a href="AquastatValidation.html"><i class="fa fa-check"></i><b>4</b> <strong>The faoswsAquastatValidation module</strong></a><ul>
<li class="chapter" data-level="4.1" data-path="AquastatValidation.html"><a href="AquastatValidation.html#aims-2"><i class="fa fa-check"></i><b>4.1</b> <strong>Aims</strong></a><ul>
<li class="chapter" data-level="4.1.1" data-path="AquastatValidation.html"><a href="AquastatValidation.html#applies-validation-rules"><i class="fa fa-check"></i><b>4.1.1</b> <strong>Applies validation rules</strong></a></li>
<li class="chapter" data-level="4.1.2" data-path="AquastatValidation.html"><a href="AquastatValidation.html#focuses-on-high-priority-rules"><i class="fa fa-check"></i><b>4.1.2</b> <strong>Focuses on high priority rules</strong></a></li>
<li class="chapter" data-level="4.1.3" data-path="AquastatValidation.html"><a href="AquastatValidation.html#reshapes-and-adds-names-to-data"><i class="fa fa-check"></i><b>4.1.3</b> <strong>Reshapes and adds names to data</strong></a></li>
<li class="chapter" data-level="4.1.4" data-path="AquastatValidation.html"><a href="AquastatValidation.html#sends-the-output-to-the-user-email"><i class="fa fa-check"></i><b>4.1.4</b> <strong>Sends the output to the user email</strong></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="AquastatValidation.html"><a href="AquastatValidation.html#workflow-3"><i class="fa fa-check"></i><b>4.2</b> <strong>Workflow</strong></a></li>
<li class="chapter" data-level="4.3" data-path="AquastatValidation.html"><a href="AquastatValidation.html#running-the-module-in-the-sws"><i class="fa fa-check"></i><b>4.3</b> <strong>Running the module in the SWS</strong></a></li>
<li class="chapter" data-level="4.4" data-path="AquastatValidation.html"><a href="AquastatValidation.html#did-the-module-1"><i class="fa fa-check"></i><b>4.4</b> <strong>Did the module</strong>…</a><ul>
<li class="chapter" data-level="4.4.1" data-path="AquastatValidation.html"><a href="AquastatValidation.html#execute-what-it-was-designed-for"><i class="fa fa-check"></i><b>4.4.1</b> execute what it was designed for?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="next.html"><a href="next.html"><i class="fa fa-check"></i><b>5</b> <strong>Next</strong></a><ul>
<li class="chapter" data-level="5.1" data-path="next.html"><a href="next.html#pending-activities"><i class="fa fa-check"></i><b>5.1</b> <strong>Pending activities</strong></a><ul>
<li class="chapter" data-level="5.1.1" data-path="next.html"><a href="next.html#faoswsaquastatexternal-module."><i class="fa fa-check"></i><b>5.1.1</b> faoswsAquastatExternal module.</a></li>
<li class="chapter" data-level="5.1.2" data-path="next.html"><a href="next.html#national-dam-capacity-time-series-using-sws-dam-data-table"><i class="fa fa-check"></i><b>5.1.2</b> National dam capacity time-series (using SWS dam data table)</a></li>
<li class="chapter" data-level="5.1.3" data-path="next.html"><a href="next.html#aggregations"><i class="fa fa-check"></i><b>5.1.3</b> Aggregations</a></li>
<li class="chapter" data-level="5.1.4" data-path="next.html"><a href="next.html#timeline"><i class="fa fa-check"></i><b>5.1.4</b> Timeline</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Migration of AQUASTAT Statistical Processes into the SWS</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="AquastatUpdate" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> <strong>The faoswsAquastaUpdate module</strong></h1>
<div id="aims-1" class="section level2">
<h2><span class="header-section-number">3.1</span> <strong>Aims</strong></h2>
<p>The <strong>faoswsAquastatUpdate</strong> module is the <em>heart</em> of the AQUASTAT migration into the SWS since it runs the periodic update of AQUASTAT dataset meant to be disseminated. The module aims to:</p>
<div id="harmonize-dimensions" class="section level3">
<h3><span class="header-section-number">3.1.1</span> <strong>Harmonize dimensions</strong></h3>
<p>With the availability of the outputs from the <strong>faoswsAquastatLegacy</strong> and <strong>faoswsAquastatExternal</strong> modules as well as the *<strong>aquastat_questionnaire</strong> dataset output by the questionnaire harvester by CIO - SWS, the faoswsAquastatUpdate module uses these three datasets as inputs. After feeding on the inputs, the module proceeds to harmonize the inputs by harmonizing their dimension names to <strong>geographicAreaM49</strong>, <strong>measuredElement</strong>, <strong>timePointYears</strong>, and <strong>flagObservationStatus</strong>.</p>
</div>
<div id="replacesupdates-the-legacy-data" class="section level3">
<h3><span class="header-section-number">3.1.2</span> <strong>Replaces/updates the legacy data</strong></h3>
<p>The <strong>aquastat_questionnaire</strong> and <strong>aquastat_external</strong> datasets are the brand new data used to update the legacy data represented by the <strong>aquastat_legacy_corr</strong> dataset. Thus, the faoswsAquastatUpdate module:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Finds</strong> and <strong>replaces</strong> rows in the <em>aquastat_legacy_corr</em> dataset by the corresponding rows of the <em>aquastat_aquestionnaire</em> dataset.</p></li>
<li><p><strong>Finds</strong> and <strong>replaces</strong> rows in the <em>aquastat_legacy_corr</em> dataset by the corresponding rows of the <em>aquastat_external</em> dataset.</p></li>
</ol>
</div>
<div id="does-calculations" class="section level3">
<h3><span class="header-section-number">3.1.3</span> <strong>Does Calculations</strong></h3>
<p>After updating the rows of the legacy data with the data from questionnaire and external source, the faoswsAquastatupdate module implements the <strong>calculation</strong> of indicators by applying the information in the SWS <strong>calculation_rule</strong> data table (see Chapter <a href="#AquastatBaseline"><strong>??</strong></a>);</p>
</div>
<div id="applies-primary-variable-approach" class="section level3">
<h3><span class="header-section-number">3.1.4</span> <strong>Applies Primary Variable Approach</strong></h3>
<p>After calculations, the module applies the primary variable approach for the indicators whose calculation rules are either addition only or subtraction-only.</p>
<p>The modules identifies AQUASTAT elements making part of calculation rules where the primary variable approach is applicable by using the SWS <strong>aquastat_reference</strong> data table containing the binary variable <strong>‘PR’</strong>. This variables uses <strong>1</strong> to identify the primary-variable-approach elements.</p>
<p><br></p>
<div class="rmdtip">
<p>
<strong>PRIMARY VARIABLE APPROACH:</strong>
</p>
<p>
<em>‘IF indicator/derived variable is empty after the calculation and its correspondent primary variable is available, replace the missing value of the indicator by the value of the primary variable’</em>.
</p>
</div>
<p><br></p>
<table>
<caption><span id="tab:pr">Table 3.1: </span>Indicators which the primary variable rule was applied to after the calculations</caption>
<thead>
<tr class="header">
<th align="right">indicator_code</th>
<th align="left">indicator_description</th>
<th align="right">primary_variable_code</th>
<th align="left">primary_variable_description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4263</td>
<td align="left">Total freshwater withdrawal (primary and secondary)</td>
<td align="right">4253</td>
<td align="left">Total water withdrawal</td>
</tr>
<tr class="even">
<td align="right">4311</td>
<td align="left">Area equipped for full control irrigation: total</td>
<td align="right">4308</td>
<td align="left">Area equipped for full control irrigation: surface irrigation</td>
</tr>
<tr class="odd">
<td align="right">4313</td>
<td align="left">Area equipped for irrigation: total</td>
<td align="right">4311</td>
<td align="left">Area equipped for full control irrigation: total</td>
</tr>
<tr class="even">
<td align="right">4317</td>
<td align="left">Total agricultural water managed area</td>
<td align="right">4313</td>
<td align="left">Area equipped for irrigation: total</td>
</tr>
<tr class="odd">
<td align="right">4459</td>
<td align="left">Area equipped for full control irrigation: pressurized (sprinkler + localized)</td>
<td align="right">4309</td>
<td align="left">Area equipped for full control irrigation: sprinkler irrigation</td>
</tr>
</tbody>
</table>
<p><br></p>
</div>
<div id="applies-imputations" class="section level3">
<h3><span class="header-section-number">3.1.5</span> <strong>Applies imputations</strong></h3>
<p>The calculation step adds indicators to the data, but does not solve the issue of time-series completeness. The Imputation step comes in the faoswsAquastatUpdate module to:</p>
<ol style="list-style-type: decimal">
<li><p>Expands variables and indicators time-series <strong>from the first observed value last observed value</strong> as agreed by the technical unit;</p></li>
<li><p>Removes <strong>0M</strong> value-flags to prevent the imputation algorithm, particularly the linear interpolation, from taking the zero values into account.</p></li>
<li><p>Fills the generated missing values using the following guideline:</p></li>
</ol>
<ul>
<li>Applies <strong>Last Observation Carried Forward</strong> to missing values in time-series where the observed values <strong>DO NOT VARY</strong>;</li>
<li>Applies <strong>Last Observation Carried Forward</strong> to missing values in time-series of Long-Term average variables (see Chapter <a href="AquastatLegacy.html#AquastatLegacy">1</a> for reference);</li>
<li>Applies <strong>Last Observation Carried Forward</strong> to missing values in time-series with only one observed value;</li>
<li>Applies <strong>Linear Interpolation</strong> to missing values in time-series with two or more different observed values.</li>
</ul>
<p><br></p>
</div>
<div id="recalculates-indicators" class="section level3">
<h3><span class="header-section-number">3.1.6</span> <strong>Recalculates indicators</strong></h3>
<p>The time-series completeness brought by imputations is used by the recalculation step to replace indicator imputed values by calculated values. Thus, the faoswsAquastatUpdate:</p>
<ol style="list-style-type: decimal">
<li><p>Takes the imputed dataset resulting from the Imputation step;</p></li>
<li><p><strong>Re-applies</strong> the calculation rules to the imputed dataset;</p></li>
<li><p><strong>Re-applies</strong> the primary variable rule to the imputed dataset;</p></li>
<li><p>Replaces indicators brought by imputations by values brought by the recalculation when applicable.</p></li>
</ol>
</div>
<div id="maps-out-flags-observation" class="section level3">
<h3><span class="header-section-number">3.1.7</span> <strong>Maps out flags (Observation)</strong></h3>
<p>After the update of the aquastat_legacy_corr by the aquastat_questionnaire and aquastat_external datasets, the the final step is the mapping between AQUASTAT and SWS flags. The faoswsAquastatUpdate module maps out AQUASTAT to valid SWS flags using the following conversion table: <br></p>
<table>
<caption><span id="tab:flagobs">Table 3.2: </span>AQUASTAT to SWS flag conversion</caption>
<thead>
<tr class="header">
<th align="left">flagAquastat</th>
<th align="left">SWS (SDMX)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">E (External value (other internationagencies)</td>
<td align="left">X (External organization)</td>
</tr>
<tr class="even">
<td align="left">K (Aggregated from two or more sources or calculated)</td>
<td align="left">E (Estimate)</td>
</tr>
<tr class="odd">
<td align="left">L (modelled value)</td>
<td align="left">E (Estimate)</td>
</tr>
<tr class="even">
<td align="left">I (Internal estimate)</td>
<td align="left">E (Estimate)</td>
</tr>
<tr class="odd">
<td align="left">F (Internal estimate)</td>
<td align="left">E (Estimate)</td>
</tr>
<tr class="even">
<td align="left">M (Missing)</td>
<td align="left">I (Imputed)</td>
</tr>
<tr class="odd">
<td align="left">blank</td>
<td align="left">blank (Official)</td>
</tr>
<tr class="even">
<td align="left"><br></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Besides the basic conversion described above, values eme</td>
<td align="left">rged from the faoswsAquastatLegacy module processing were flagged as follow:</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: decimal">
<li><p>All indicators emerging from calculations/recalculations have SWS flagObservationStatus = <strong>‘E’</strong>;</p></li>
<li><p>All missing values are filled by the imputations have SWS flagObservationStatus <strong>‘I’</strong>;</p></li>
<li><p>The flagAquastat <strong>M</strong> becomes the flagObservationStatus <strong>I</strong> because all M values are transformed into missing to avoid errors from linear interpolation.</p></li>
</ol>
</div>
<div id="maps-out-flags-method" class="section level3">
<h3><span class="header-section-number">3.1.8</span> <strong>Maps out flags (Method)</strong></h3>
<p>With regard to the flag of methods in SWS, the conversion follows:</p>
<ol style="list-style-type: decimal">
<li><p>When the value is imputed from the module AND the imputation method is LOCF, the flag method is <strong>‘t’</strong>;</p></li>
<li><p>When the value is imputed from the module and the method is LOCF, the flag of method is <strong>‘e’</strong>;</p></li>
<li><p>When the value is calculated or recalculated the flag of method is <strong>‘i’</strong>.</p></li>
<li><p>When the value has flagObservationStatus <strong>‘E’</strong> and DOES NOT COME FROM PROCESSING, the flag of method is <strong>‘-’</strong>;</p></li>
<li><p>When the value has flagObservationStatus <strong>blank</strong> and DOES NOT COME FROM PROCESSING, the flag of method is <strong>‘p’</strong> ;</p></li>
<li><p>When the value has flagObservationStatus <strong>‘X’</strong> and DOES NOT COME FROM PROCESSING, the flag of method is <strong>‘c’</strong>;</p></li>
</ol>
<p><br></p>
<table>
<caption><span id="tab:flagmeth">Table 3.3: </span>flagObservationStatus - flagMethod combination brought by the faoswsAquastatLegacy module</caption>
<thead>
<tr class="header">
<th align="left">flagObservationStatus</th>
<th align="left">flagMethod</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">X (External organization)</td>
<td align="left">c (copied in the system)</td>
</tr>
<tr class="even">
<td align="left">I (Imputed)</td>
<td align="left">t (Carry-forward estimate)</td>
</tr>
<tr class="odd">
<td align="left">I (Imputed)</td>
<td align="left">e Estimate by statistical algorithm)</td>
</tr>
<tr class="even">
<td align="left">E (Estimate)</td>
<td align="left">i (calculated as identity)</td>
</tr>
<tr class="odd">
<td align="left">E (Estimate)</td>
<td align="left">“-” (unknown method)</td>
</tr>
<tr class="even">
<td align="left">“<blank>” (Official)</td>
<td align="left">p (Collected manually from databases)</td>
</tr>
<tr class="odd">
<td align="left"><br></td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="workflow-2" class="section level2">
<h2><span class="header-section-number">3.2</span> <strong>Workflow</strong></h2>
<div class="figure"><span id="fig:fig1"></span>
<div id="htmlwidget-42ee33f78471fd101dcc" style="width:100%;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-42ee33f78471fd101dcc">{"x":{"diagram":"digraph {\n\ngraph [layout = dot, rankdir = LR]\n\n# define the global styles of the nodes. We can override these in box if we wish\nnode [shape = rectangle, style = filled, fillcolor = Linen]\n\n# Inputs\naquabase [label = \"Dataset: \n SWS aquastat_legacy_corr \n from the faoswsAquastatLegacy module\", shape = folder, fillcolor = Beige]\naquaquest [label = \"Dataset: \n SWS aquastat_questionnaire \n from the questionnaire harvester\", shape = folder, fillcolor = Beige]\naquaexter [label = \"Dataset: \n SWS aquastat_external \n from the faoswsAquastatExternal module\", shape = folder, fillcolor = Beige]\n\n# data tables\nrefer [label = \"Data table: \n SWS aquastat_reference data table\", shape = folder, fillcolor = LightGrey]\ncalc [label = \"Data table: \n SWS calculation_rule data table\", shape = folder, fillcolor = LightGrey]\n\n# processing\nProcessing [label = \"Processing: \n 1. Harmonize dimensions \n 2. Replace/Update aquastat_legacy_corr \n with aquastat_questionnaire \n and aquastat_external dataset, \n 3. Calculations, \n 4. Imputations, \n 5. Recalculations, \n 6. Flag conversion\", shape = square, fillcolor = LightBlue]\n\n# Output\nOutput [label = \"Dataset: \n aquastat_update dataset\", shape = folder, fillcolor = Beige]\n\n#Save\nSave [label = \"Database: \n aquastat_update dataset \n saved in the SWS\", shape = folder, fillcolor = Beige]\n\n\n# Flow\n# edge definitions with the node IDs\n{aquaquest, aquabase, aquaexter} -> Processing  -> Output -> Save\n{refer, calc} -> Processing\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.1: Workflow of the faoswsAquastatUpdate module.
</p>
</div>
<p><br> <br></p>
</div>
<div id="running-the-module-2" class="section level2">
<h2><span class="header-section-number">3.3</span> <strong>Running the module</strong></h2>
<ol style="list-style-type: decimal">
<li><p>Log in the SWS;</p></li>
<li><p>Click on <strong>New Query</strong>;</p></li>
<li><p>Select <strong>AQUASTAT domain</strong> and <strong>aquastat_update dataset</strong>;</p></li>
<li><p>Select whatever country, measured element, and timePointYears;</p></li>
</ol>
<div class="rmdnote">
<p>
The <strong>faoswsAquastatUpdate</strong> module updates the <strong>aquastat_legacy_corr</strong> dataset (corrected legacy data) using the <strong>aquastat_questionnarie</strong> and <strong>aquastat_export</strong> datasets that were saved into the SWS database in the previous steps. It means that that the user’s selections during this step are irrelevant for the module’s output.
</p>
</div>
<ol start="5" style="list-style-type: decimal">
<li><p>Run the query;</p></li>
<li><p>Click on <strong>Run plugin</strong> on the top-right.</p></li>
<li><p>Select the <strong>faoswsAquastatUpdate</strong> module and click on <strong>Run plugin</strong>;</p></li>
<li><p>Wait for the results to appear in the session;</p></li>
<li><p>Click on <strong>Save to dataset</strong> after validation.</p></li>
</ol>
<p><br> <br></p>
</div>
<div id="did-the-module" class="section level2">
<h2><span class="header-section-number">3.4</span> <strong>Did the module…</strong></h2>
<div class="rmdwarning">
<p>
The module is in progress waiting for:
</p>
<ul>
<li>
The completion of aqua_external_source data table by the same technical unit so the faoswsAquastatExternal module can be developed and produces the aquastat_external dataset.
</li>
</ul>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="External.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="AquastatValidation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
